<mat-card>
  <mat-card-header>
    <mat-card-title>Lab Results</mat-card-title>
  </mat-card-header>

  <mat-card-content style="margin-top:20px" [style.overflow]="'auto'" [style.height.%]="matCardContentHeight">

    <table mat-table [dataSource]="dataSource" multiTemplateDataRows>

      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row">
          <b>{{row.category}} ({{row.count}})</b>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedRow">
        <td mat-cell
          *matCellDef="let categoryRow"
          [attr.colspan]="columnsToDisplay.length">
          <div class="case-record-detail"
               [@detailExpand]="categoryRow != expandedRow ? 'expanded' : 'collapsed'">

            <table mat-table [dataSource]="categoryRow.data">-->

              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let detailsRow"
                    [ngClass]="{'flagged': !!detailsRow.flag}">
                    {{detailsRow.date | date}}</td>
              </ng-container>

              <ng-container matColumnDef="question">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let detailsRow"
                    [ngClass]="{'flagged': !!detailsRow.flag}">
                  {{detailsRow?.details?.tableDisplayText}}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="innerTableDisplayColumns"></tr>
              <tr mat-row *matRowDef="let detailsRow; columns: innerTableDisplayColumns;"
                  (click)="onRowClick( detailsRow )" style="cursor: pointer">
              </tr>

            </table>
          </div>

        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr
        mat-row
        *matRowDef="let categoryRow; columns: columnsToDisplay;"
        class="case-record-row"
        [class.example-expanded-row]="expandedRow === categoryRow"
        (click)="expandedRow = expandedRow === categoryRow ? null : categoryRow"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedRow']"
        class="case-record-detail-row"
      ></tr>

    </table>
  </mat-card-content>

  <mat-card-actions align="end">
    <button mat-raised-button color="primary">
      <mat-icon>add</mat-icon>
      Add Result
    </button>
  </mat-card-actions>

</mat-card>
